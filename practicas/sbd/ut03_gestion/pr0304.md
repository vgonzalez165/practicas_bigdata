```
------------- ESPECIALIZACIÓN EN INTELIGENCIA ARTIFICIAL Y BIG DATA -------------
---------------------------------------------------------------------------------

Módulo:                     SISTEMAS DE BIG DATA
Profesor:                   Víctor J. González
Unidad de Trabajo:          UT03. Gestión de los datos
Práctica:                   PR0304: API de Spotify
Resultados de aprendizaje:  
```


# PR0304: API de Spotify


## 1. Contexto del Proyecto

En esta práctica vamos a automatizar la descarga masiva de discografías completas utilizando la API de Spotify.


## 2. Enunciado de las tareas

### Fase 1: Configuración y autenticación

1. Regístrate en el [Dashboard de Desarrolladores de Spotify](https://developer.spotify.com/dashboard/) y crea una nueva aplicación.
2. Obtén tu `Client ID` y `Client Secret`.
3. Desarrolla un script en Python que intercambie estas credenciales por un **Access Token** válido usando el método `POST` contra el endpoint de autenticación. El token caduca cada hora, por lo que el código debería ser capaz de detectar si el token ha expirado (o simplemente solicitar uno nuevo al inicio de la ejecución).


### Fase 2: Extracción 

Debes crear una función que, dado el nombre de un artista (ej: *"Daft Punk"*, *"Rosalía"*, *"Queen"*), realice el siguiente flujo de llamadas en cascada:

1. **Buscar al artista:** obtener el `artist_id` único de Spotify.
2. **Obtener álbumes:** descargar la lista de álbumes del artista.
   - Debes filtrar para obtener solo álbumes de estudio (`album_type='album'`) y sencillos (`album_type='single'`), ignorando compilatorios si es posible.
   - Si el artista tiene más de 20 o 50 álbumes, tu script debe recorrer todas las páginas disponibles.
3. **Obtener pistas:** para cada álbum, descargar la lista de canciones con sus IDs.
4. **Obtener "Audio Features":** estos sería realmente los datos que necesitaríamos si fueramos a usar nuestro *dataset* para un proyecto de IA. Usando los IDs de las canciones, consulta el endpoint `audio-features`. Ten en cuenta que este endpoint permite enviar hasta 100 IDs separados por comas en una sola llamada. Optimiza tu código para hacer esto en lotes y no llamada por llamada.

### Fase 3: Estructuración y persistencia

Los datos recibidos son JSONs anidados. Debes procesarlos para generar un **DataFrame de Pandas** y exportarlo finalmente a un archivo **CSV**.

El dataset final debe tener las siguientes columnas (como mínimo):
`artist_name`, `album_name`, `track_name`, `track_id`, `release_date`, `popularity`, `danceability`, `energy`, `loudness`, `valence`, `tempo`, `duration_ms`.


## 3. Requisitos técnicos y restricciones

1. **Manejo de errores:** el script no debe romperse si un álbum no tiene canciones o si la API devuelve un error 404. Debe capturar la excepción y continuar.
2. **Rate limiting:** implementa un pequeño `time.sleep()` entre peticiones para reintentar si recibes un error **429 (Too Many Requests)**.
3. **Código limpio:** se valorará la modularización (funciones separadas para autenticación, búsqueda, obtención de features, etc.).

