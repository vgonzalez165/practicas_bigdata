```
------------- ESPECIALIZACIÓN EN INTELIGENCIA ARTIFICIAL Y BIG DATA -------------
---------------------------------------------------------------------------------

Módulo:                     SISTEMAS DE BIG DATA
Profesor:                   Víctor J. González
Unidad de Trabajo:          UT03. Gestión de los datos
Práctica:                   PR0304: API de Spotify
Resultados de aprendizaje:  
```


# PR0304: API de Spotify


## 1. Contexto del Proyecto

En esta práctica vamos a automatizar la descarga masiva de discografías completas utilizando la API de Spotify.


## 2. Enunciado de las tareas

### Fase 1: Configuración y autenticación

1. Regístrate en el [Dashboard de Desarrolladores de Spotify](https://developer.spotify.com/dashboard/) y crea una nueva aplicación.
2. Obtén tu `Client ID` y `Client Secret`.
3. Desarrolla un script en Python que intercambie estas credenciales por un **Access Token** válido usando el método `POST` contra el endpoint de autenticación. El token caduca cada hora, por lo que el código debería ser capaz de detectar si el token ha expirado (o simplemente solicitar uno nuevo al inicio de la ejecución).


### Fase 2: Extracción 

Debes crear una función que, dado el nombre de un artista (ej: *"Daft Punk"*, *"Rosalía"*, *"Queen"*), realice el siguiente flujo de llamadas en cascada:

1. **Buscar al artista:** obtener el `artist_id` único de Spotify.
2. **Obtener álbumes:** descargar la lista de álbumes del artista.
   - Debes filtrar para obtener solo álbumes de estudio (`album_type='album'`) y sencillos (`album_type='single'`), ignorando compilatorios si es posible.
   - Si el artista tiene más de 20 o 50 álbumes, tu script debe recorrer todas las páginas disponibles.
3. **Obtener pistas:** para cada álbum, descargar la lista de canciones con sus IDs.
4. **Obtener "Audio Features":** estos sería realmente los datos que necesitaríamos si fueramos a usar nuestro *dataset* para un proyecto de IA. Usando los IDs de las canciones, consulta el endpoint `audio-features`. Ten en cuenta que este endpoint permite enviar hasta 100 IDs separados por comas en una sola llamada. Optimiza tu código para hacer esto en lotes y no llamada por llamada.

### Fase 3: Estructuración y persistencia

Los datos recibidos son JSONs anidados. Debes procesarlos para generar un **DataFrame de Pandas** y exportarlo finalmente a un archivo **CSV**.

El dataset final debe tener las siguientes columnas (como mínimo):
`artist_name`, `album_name`, `track_name`, `track_id`, `release_date`, `popularity`, `danceability`, `energy`, `loudness`, `valence`, `tempo`, `duration_ms`.


## 3. Requisitos técnicos y restricciones

1. **Manejo de errores:** el script no debe romperse si un álbum no tiene canciones o si la API devuelve un error 404. Debe capturar la excepción y continuar.
2. **Rate limiting:** implementa un pequeño `time.sleep()` entre peticiones para reintentar si recibes un error **429 (Too Many Requests)**.
3. **Código limpio:** se valorará la modularización (funciones separadas para autenticación, búsqueda, obtención de features, etc.).


## Anexo: Relación de Audio Features

Los **Audio Features** de la API de Spotify son un conjunto de métricas numéricas que describen las características musicales y psicológicas de una canción.

Básicamente, Spotify usa algoritmos de aprendizaje automático para "escuchar" cada pista y asignarle puntajes en diferentes categorías. Esto permite que los desarrolladores y analistas de datos puedan clasificar música sin tener que escucharla realmente.

Aquí tienes el desglose de las métricas más importantes:

### 1. Métricas de "Vibra" (subjetivas)

- **Danceability (bailabilidad):** (0.0 a 1.0) Describe qué tan adecuada es una canción para bailar basándose en el ritmo, la estabilidad del tempo y la fuerza del pulso.
- **Energy (energía):** (0.0 a 1.0) Mide la intensidad y actividad. Las canciones rápidas, fuertes y ruidosas (como el metal) tienen puntajes altos; un preludio de Bach tendría uno bajo.
- **Valence (valencia):** (0.0 a 1.0) Describe la "positividad" musical. Puntajes altos suenan alegres o eufóricos; puntajes bajos suenan tristes, deprimidos o enojados.
- **Speechiness (presencia de voz):** (0.0 a 1.0) Detecta palabras habladas. Por encima de 0.66 suelen ser podcasts o audiolibros; entre 0.33 y 0.66 suele ser rap; por debajo de 0.33 es música pura.

### 2. Métricas técnicas (objetivas)

* **Acousticness (acústica):** (0.0 a 1.0) Confianza de si la pista fue creada con instrumentos acústicos frente a electrónicos.
* **Instrumentalness:** (0.0 a 1.0) Predice si una canción no tiene voz. Los "ooh" y "aah" se consideran instrumentales, pero las letras habladas no.
* **Liveness (en vivo):** Detecta la presencia de audiencia en la grabación. Un valor superior a 0.8 indica una alta probabilidad de que sea un concierto.
* **Loudness (sonoridad):** El volumen promedio en decibelios (dB). Suele oscilar entre -60 y 0 dB.
* **Tempo:** Los latidos por minuto (BPM) estimados.

### 3. Propiedades musicales

* **Key (tono):** El tono en el que está la canción usando la notación de clase de tono estándar (0 = C, 1 = C♯/D♭, etc.).
* **Mode (modo):** Indica si la canción está en una escala mayor (1) o menor (0).
* **Time Signature:** El compás estimado (ej. 3/4, 4/4, 5/4).


### ¿Para qué se usan?

Estas métricas son el motor detrás de funciones como **"Daily Mix"** o **"Descubrimiento Semanal"**. Los desarrolladores las usan para:

1. **Crear filtros:** "solo quiero canciones de mi lista que sean muy bailables y tengan energía alta".
2. **Análisis de datos:** comparar cómo ha cambiado el estado de ánimo de la música popular a lo largo de las décadas.
3. **Transiciones perfectas:** DJs usan el *Tempo* y el *Key* para mezclar canciones sin que se note el cambio.
